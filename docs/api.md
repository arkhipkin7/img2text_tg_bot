# API Документация

## Обзор

Product Content Generator API - это REST API для генерации контента товаров на основе изображений и текста. API построен на FastAPI и предоставляет эндпоинты для создания SEO-оптимизированных описаний товаров.

## Базовый URL

```
http://localhost:8000
```

## Аутентификация

В текущей версии API не требует аутентификации. В продакшене рекомендуется добавить API ключи или JWT токены.

## Endpoints

### Health Check

Проверка состояния API сервера.

**Endpoint:** `GET /health`

**Ответ:**
```json
{
  "status": "healthy",
  "version": "1.0.0",
  "timestamp": "2024-01-01T12:00:00"
}
```

**Коды ответов:**
- `200` - API работает нормально
- `503` - API недоступен

### Generate Content

Генерация контента товара на основе изображения и/или текста.

**Endpoint:** `POST /generate`

**Content-Type:** `multipart/form-data`

**Параметры:**

| Параметр | Тип | Обязательный | Описание |
|----------|-----|--------------|----------|
| `type` | string | Да | Тип обработки: `image_only`, `text_only`, `both` |
| `text` | string | Нет* | Текстовое описание товара |
| `image` | file | Нет* | Изображение товара |

*Обязателен в зависимости от типа обработки

**Типы обработки:**

1. **`image_only`** - только изображение
   - Обязательно: `image`
   - Необязательно: `text`

2. **`text_only`** - только текст
   - Обязательно: `text`
   - Необязательно: `image`

3. **`both`** - изображение + текст
   - Обязательно: `image`, `text`

**Ответ:**
```json
{
  "title": "Название товара",
  "short_description": "Краткое описание товара",
  "full_description": "Полное описание товара с характеристиками",
  "features": [
    "Высокое качество",
    "Стильный дизайн",
    "Удобство использования"
  ],
  "seo_keywords": [
    "качественный",
    "стильный",
    "удобный",
    "практичный"
  ],
  "target_audience": [
    "Молодежь 18-25 лет",
    "Активные люди 25-35 лет",
    "Студенты"
  ]
}
```

**Коды ответов:**
- `200` - Контент успешно сгенерирован
- `400` - Неверные параметры запроса
- `422` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

## Примеры использования

### cURL

**Генерация из текста:**
```bash
curl -X POST "http://localhost:8000/generate" \
  -F "type=text_only" \
  -F "text=Стильные кроссовки для спорта и повседневной носки"
```

**Генерация из изображения:**
```bash
curl -X POST "http://localhost:8000/generate" \
  -F "type=image_only" \
  -F "image=@product.jpg"
```

**Комбинированная генерация:**
```bash
curl -X POST "http://localhost:8000/generate" \
  -F "type=both" \
  -F "text=Стильные кроссовки для спорта" \
  -F "image=@product.jpg"
```

### Python

```python
import requests

# Генерация из текста
response = requests.post(
    "http://localhost:8000/generate",
    data={
        "type": "text_only",
        "text": "Стильные кроссовки для спорта"
    }
)

if response.status_code == 200:
    content = response.json()
    print(f"Название: {content['title']}")
    print(f"Описание: {content['short_description']}")
```

### JavaScript

```javascript
// Генерация из изображения
const formData = new FormData();
formData.append('type', 'image_only');
formData.append('image', fileInput.files[0]);

fetch('http://localhost:8000/generate', {
    method: 'POST',
    body: formData
})
.then(response => response.json())
.then(data => {
    console.log('Название:', data.title);
    console.log('Описание:', data.short_description);
});
```

## Ограничения

### Файлы

- **Поддерживаемые форматы:** JPG, JPEG, PNG, WEBP
- **Максимальный размер:** 20MB
- **Максимальное разрешение:** 1920x1920 (автоматически изменяется)

### Текст

- **Максимальная длина:** 5000 символов
- **Кодировка:** UTF-8

### Запросы

- **Таймаут:** 60 секунд
- **Максимальный размер запроса:** 25MB

## Обработка ошибок

### Структура ошибки

```json
{
  "error": "Описание ошибки",
  "detail": "Детальная информация об ошибке"
}
```

### Коды ошибок

| Код | Описание |
|-----|----------|
| `400` | Неверный запрос - проверьте параметры |
| `422` | Ошибка валидации - неверный формат данных |
| `500` | Внутренняя ошибка сервера |
| `503` | Сервис недоступен |

### Примеры ошибок

**Неверный тип обработки:**
```json
{
  "error": "Ошибка валидации",
  "detail": "1 validation error for GenerateRequest\ntype\n  value is not a valid enumeration member; permitted: 'image_only', 'text_only', 'both' (type=type_error.enum; enum_values=[Enum('image_only'), Enum('text_only'), Enum('both')])"
}
```

**Отсутствует обязательный параметр:**
```json
{
  "error": "Внутренняя ошибка сервера",
  "detail": "Изображение обязательно для типа 'image_only'"
}
```

**Файл слишком большой:**
```json
{
  "error": "Внутренняя ошибка сервера",
  "detail": "Размер файла превышает лимит: 25000000 > 20971520"
}
```

## Rate Limiting

В текущей версии API не имеет ограничений на количество запросов. В продакшене рекомендуется добавить rate limiting для предотвращения злоупотреблений.

## Версионирование

API использует семантическое версионирование. Текущая версия: `1.0.0`

Для доступа к конкретной версии API используйте заголовок:
```
Accept: application/vnd.api.v1+json
```

## WebSocket (планируется)

В будущих версиях планируется добавить WebSocket поддержку для real-time генерации контента.

## Поддержка

При возникновении проблем с API:

1. Проверьте логи сервера
2. Убедитесь в правильности параметров запроса
3. Проверьте формат и размер файлов
4. Обратитесь к документации по кодам ошибок 