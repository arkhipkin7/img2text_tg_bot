# –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## –ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ —Ä–µ—à–µ–Ω–∞

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**: –î–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∫–≤–æ—Ç—ã, –ø–æ–¥–ø–∏—Å–∫–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞) —Ç–µ—Ä—è–ª–∏—Å—å –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Redis.

## –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Redis

- üî¢ **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`free_used`)
- üíé **–ö—É–ø–ª–µ–Ω–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã** –∏ –∏—Ö –æ—Å—Ç–∞—Ç–∫–∏ (`plan_remaining`)
- üéÅ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** (`extra_remaining`)
- üìÖ **–î–∞—Ç—ã —Å–±—Ä–æ—Å–∞** –º–µ—Å—è—á–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤ (`next_reset_ts`)
- üìä **–ü–ª–∞–Ω—ã –ø–æ–¥–ø–∏—Å–æ–∫** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`plan`)

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è

### 1. Docker Volume
```yaml
volumes:
  redis_data:
    driver: local
```

### 2. Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```yaml
redis:
  volumes:
    - redis_data:/data
  command: redis-server --appendonly yes --save 60 1000
```

### 3. –ú–µ—Ö–∞–Ω–∏–∑–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

#### AOF (Append Only File)
- ‚úÖ **–í–∫–ª—é—á–µ–Ω**: `--appendonly yes`
- üìù **–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –æ–ø–µ—Ä–∞—Ü–∏—é** –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- üîÑ **–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ** –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

#### RDB Snapshots
- ‚úÖ **–í–∫–ª—é—á–µ–Ω**: `--save 60 1000`
- üíæ **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–Ω–∏–º–æ–∫** –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ >= 1000 –∏–∑–º–µ–Ω–µ–Ω–∏–π
- üèÉ‚Äç‚ôÇÔ∏è **–ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö

## –ß—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- –ö–≤–æ—Ç—ã **–ù–ï –°–ë–†–ê–°–´–í–ê–Æ–¢–°–Ø** –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
- –ö—É–ø–ª–µ–Ω–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã **–°–û–•–†–ê–ù–Ø–Æ–¢–°–Ø** –Ω–∞–≤—Å–µ–≥–¥–∞
- –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è **–ù–ï –¢–ï–†–Ø–ï–¢–°–Ø**

### ‚úÖ –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ **–ë–ï–ó–û–ü–ê–°–ï–ù**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã **–ù–ï –í–õ–ò–Ø–Æ–¢** –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
- –ê–≤–∞—Ä–∏–π–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ **–ù–ï –ü–†–ò–í–û–î–ò–¢** –∫ –ø–æ—Ç–µ—Ä–µ –∫–≤–æ—Ç

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ
- Redis —Å–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª—ã –≤ `/data` volume
- Docker —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–µ

### –†—É—á–Ω–æ–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
docker exec img2text-redis redis-cli BGSAVE
docker cp img2text-redis:/data ./backup-$(date +%Y%m%d)

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏  
docker cp ./backup-20250818 img2text-redis:/data
docker restart img2text-redis
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
```bash
docker exec img2text-redis redis-cli info persistence
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
docker exec img2text-redis redis-cli hgetall sub:user:USER_ID
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **Volume —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
2. **–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** –¥–∞–∂–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
3. **–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ volume** –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã
4. **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ Redis
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã (docker-compose down/up)
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- ‚úÖ AOF –∏ RDB —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –∏—Ö –∫–≤–æ—Ç—ã –∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç–∞—Ö –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–∏—Å—Ç–µ–º—ã! üõ°Ô∏è

